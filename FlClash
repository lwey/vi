# ===================================
#é”šç‚¹å¼€å§‹
#è®¢é˜…åå’Œè®¢é˜…é“¾æ¥ã€å›¾æ ‡
Provider1: &Provider1 "Eless"
Provider1Icon: &Provider1Icon "https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/Linkeless.png"
Provider2: &Provider2 "sntp"
Provider2Icon: &Provider2Icon "https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/shouhou(4).png"

# è¿é€šæ€§æ£€æµ‹url
HeaCheckUrl: &HeaCheckUrl "https://www.apple.com/library/test/success.html"

# èŠ‚ç‚¹ç­›é€‰æ­£åˆ™
FilterHK: &FilterHK '(?i)(æ¸¯|ğŸ‡­ğŸ‡°|\bHK\b|hongkong|hong kong)'
FilterTW: &FilterTW '(?i)(ğŸ‡¨ğŸ‡³|ğŸ‡¹ğŸ‡¼|å°|\bTW\b|taiwan)'
FilterSG: &FilterSG '(?i)(æ–°|ğŸ‡¸ğŸ‡¬|sg|singapore)'
FilterJP: &FilterJP '(?i)(æ—¥æœ¬|ğŸ‡¯ğŸ‡µ|å·æ—¥|ä¸œäº¬|å¤§é˜ª|æ³‰æ—¥|åŸ¼ç‰|æ²ªæ—¥|æ·±æ—¥|\bJP\b|Japan)'
FilterKr: &FilterKR '^(?!.*((?i)Ukraine)).*(?i)(KOR|ğŸ‡°ğŸ‡·|éŸ©å›½|é¦–å°”|éŸ©|éŸ“|\bKR\b|Korea)'
FilterUS: &FilterUS '(?i)(ç¾|ğŸ‡ºğŸ‡¸|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|ä¿„å‹’å†ˆ|å‡¤å‡°åŸ|è´¹åˆ©è’™|ç¡…è°·|æ‹‰æ–¯ç»´åŠ æ–¯|æ´›æ‰çŸ¶|åœ£ä½•å¡|åœ£å…‹æ‹‰æ‹‰|è¥¿é›…å›¾|èŠåŠ å“¥|\bUS\b|unitedstates|united states)'
#FilterRU: &FilterRU '(?i)(ğŸ‡·ğŸ‡º|ä¿„ç½—æ–¯|è«æ–¯|\bRU\b|Russia|Moscow)'
#FilterOther: &FilterOther '^(?!.*(?i)(?:ğŸ‡¨ğŸ‡³|ğŸ‡¨ğŸ‡³|ğŸ‡¹ğŸ‡¼|ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡°ğŸ‡·|ğŸ‡·ğŸ‡ºæ¸¯|\bHK\b|Hong Kong|HongKong|hongkong|æ—¥æœ¬|å·æ—¥|ä¸œäº¬|å¤§é˜ª|æ³‰æ—¥|åŸ¼ç‰|æ²ªæ—¥|æ·±æ—¥|[^-]æ—¥|\bHeaCheckUrlHeaCheckUrlJP\b|Japan|ç¾|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|ä¿„å‹’å†ˆ|å‡¤å‡°åŸ|è´¹åˆ©è’™|ç¡…è°·|æ‹‰æ–¯ç»´åŠ æ–¯|æ´›æ‰çŸ¶|åœ£ä½•å¡|åœ£å…‹æ‹‰æ‹‰|è¥¿é›…å›¾|èŠåŠ å“¥|\bUS\b|United States|å°|æ–°åŒ—|å½°åŒ–|\bTW\b|Taiwan|\bKR\b|Korea|KOR|é¦–å°”|éŸ©|éŸ“|ç‹®åŸ|ç‹®|æ–°åŠ å¡|å¡|\bSG\b|Singapore|ä¿„ç½—æ–¯|è«æ–¯|\bRU\b|Russia|Moscow)).*$'
ExcludeFilter: &ExcludeFilter '(?i)(ä½£é‡‘|å¥—é¤|å®˜ç½‘|å®˜æ–¹|å”®å|å…ç¿»|ç›´è¿|è¿‡æœŸ|å‰©ä½™|åˆ°æœŸ|æµé‡|æ›´æ–°|ç‚¹å¤–|é‡ç½®|å…æµ|ä¼˜æƒ |è¶…å®æƒ |å€|AFF|Direct|Days|Date)'
FilterLowMag: &FilterLowMag '0\.\d+'           #ä½å€ç‡èŠ‚ç‚¹
FilterHighMag: &FilterHighMag '(?!0\.)[1-9]\d*(?:\.\d+)'            #é«˜å€ç‡èŠ‚ç‚¹

# è®¢é˜…æ›´æ–°ä¸æµ‹è¯•
Proxyer: &Proxyer
    type: http
    interval: 3600
    health-check:
      enable: true
      url: *HeaCheckUrl
      tolerance: 50
      timeout: 5000

# è®¢é˜…å¼•ç”¨
Uses: &Uses 
    type: select
    include-all-providers: true
    exclude-filter: *ExcludeFilter

# ç­–ç•¥ç»„å¼•ç”¨
Selector: &Selector
   type: select
   proxies: [ é¦™æ¸¯, å°æ¹¾, æ–°åŠ å¡, æ—¥æœ¬, éŸ©å›½, ç¾å›½, ä½å€, é«˜å€ ]

# å»¶è¿Ÿä¼˜é€‰ç­–ç•¥ç»„
auto: &auto
   type: url-test 
   url: *HeaCheckUrl
   tolerance : 50
   interval: 300
   timeout : 5000
   <<: *Uses     

# è´Ÿè½½å‡è¡¡ç­–ç•¥ç»„ç­–ç•¥å¯é€‰round-robin, consistent-hashing
loads: &loads
   type: load-balance
   url: *HeaCheckUrl
   interval: 300
   strategy: sticky-sessions
   <<: *Uses

# æ•…éšœè½¬ç§»
fallb: &fallb
  type: fallback
  url: *HeaCheckUrl
  interval: 300
  <<: *Uses

rule-anchor:
  # è§„åˆ™ç±»å‹:domain
  dom: &dom { type: http, behavior: domain, interval: 86400 }
  # è§„åˆ™ç±»å‹:classical
  cla: &cla { type: http, behavior: classical, interval: 86400 }
  # è§„åˆ™ç±»å‹:ipcidr
  ipc: &ipc { type: http, behavior: ipcidr, interval: 86400 }

proxies:
  - name: ç›´è¿
    type: direct
    udp: true
  - name: ç¦æ­¢
    type: reject
  - name: DNSåŠ«æŒ
    type: dns
    udp: true

proxy-providers:      
  Sub-Store:
    <<: *Proxyer
    path: ./proxies/Sub-Store.yaml
    url: 'https://sub.xfltd.click/api/v1/client/subscribe?token=eb12a3e82e14a816698b1d358f06da22'
#    exclude-filter: *ExcludeFilter
    override:
      udp: true
  

proxy-groups:
#  - { name: AdBlock, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Advertising.png", <<: *Selector }
  - { name: Telegram, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Telegram.png", <<: *Selector }
  - { name: TikTok, icon: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/icon/color/tiktok.png", <<: *Selector } 
  - { name: YouTube, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/YouTube.png", <<: *Selector }
  - { name: Google, icon: "https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/google(1).png", <<: *Selector }
  - { name: Media, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/ForeignMedia.png", <<: *Selector }
  - { name: Microsoft, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Microsoft.png", <<: *Selector } 
  - { name: VPN, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Server.png", <<: *Selector }
  - { name: Emby, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Emby.png", <<: *Selector }
  - { name: Global, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Global.png", <<: *Selector } 
  - { name: Cloudflare, icon: "https://raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/Cloudflare.png", <<: *Selector }
  - { name: Domestic, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Domestic.png", <<: *Selector }  
  - { name: Final, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Final.png", <<: *Selector }
  # æ‰‹åŠ¨ï¼†è‡ªåŠ¨
  - { name: è‡ªé€‰, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/MY.png", <<: *Uses }
#  - { name: è‡ªåŠ¨, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Auto.png", <<: *auto }
  # åˆ†éš”,ä¸‹é¢æ˜¯åœ°åŒºåˆ†ç»„
  # æ•…éšœè½¬ç§»åˆ†ç»„(fallback)
  - { name: é¦™æ¸¯, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Hong_Kong.png", <<: *fallb, filter: *FilterHK, hidden: true }  
  - { name: å°æ¹¾, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Taiwan.png", <<: *fallb, filter: *FilterTW, hidden: true } 
  - { name: æ–°åŠ å¡, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Singapore.png", <<: *fallb, filter: *FilterSG, hidden: true } 
  - { name: æ—¥æœ¬, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Japan.png", <<: *fallb, filter: *FilterJP, hidden: true }
  - { name: éŸ©å›½, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Korea.png", <<: *fallb, filter: *FilterKR, hidden: true }  
  - { name: ç¾å›½, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_States.png", <<: *fallb, filter: *FilterUS, hidden: true }
#  - { name: ä¿„å›½, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Russia.png", <<: *fallb, filter: *FilterRU, hidden: true }
#  - { name: å…¶ä»–, icon: "https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/quanqiu(3).png", <<: *fallb, filter: *FilterOther, hidden: true}
  - { name: ä½å€, icon: "https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/liuliang(2).png", <<:  *fallb, filter: *FilterLowMag, hidden: true }
  - { name: é«˜å€, icon: "https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/liuliang(3).png", <<: *fallb, filter: *FilterHighMag, hidden: true }
  # æœºåœºåˆ†ç»„
  - name: *Provider1
    <<: *Uses
    filter: *Provider1
    icon: *Provider1Icon
    hidden: true
  - name: *Provider2
    <<: *Uses
    filter: *Provider2
    icon: *Provider2Icon
    hidden: true


rule-providers:
  ç§‹é£å¹¿å‘Šè§„åˆ™: {<<: *dom, format: yaml, url: "https://raw.githubusercontent.com/TG-Twilight/AWAvenue-Ads-Rule/main/Filters/AWAvenue-Ads-Rule-Clash.yaml", path: ./rules/AWAvenue-Ads-Rule-Clash.yaml}
  advertising: {<<: *cla, format: yaml, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/Advertising/Advertising_Classical_No_Resolve.yaml", path: ./rules/advertising.yaml}
  GoogleFCM: {<<: *cla, format: yaml, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/GoogleFCM/GoogleFCM_No_Resolve.yaml", path: ./rules/GoogleFCM.yaml}

rules:
  - DST-PORT,53,DNSåŠ«æŒ
#  - IP-SUFFIX,121.41.111.155,ç›´è¿,no-resolve
#  - AND,((DST-PORT,443),(NETWORK,UDP)),REJECT-DROP    # å±è”½QUIC
  - DOMAIN-REGEX,^ad\..*|ads\..*,REJECT-DROP
  - DOMAIN-REGEX, ^hk(?:[^.]+\.){1,2}(?:wechat|wexin)\.com$,é¦™æ¸¯
  - DOMAIN-REGEX, ^sg(?:[^.]+\.){1,2}(?:wechat|wexin)\.com$,æ–°åŠ å¡
  - DOMAIN-KEYWORD,linkeless,VPN
  - DOMAIN-KEYWORD,sntp,VPN  
  - DOMAIN-SUFFIX,metacubex.one,Global

  - RULE-SET,advertising,REJECT-DROP 
  - RULE-SET,ç§‹é£å¹¿å‘Šè§„åˆ™,REJECT-DROP
  - RULE-SET,GoogleFCM,Domestic

#æœ¬åœ°å±€åŸŸç½‘
  - DOMAIN-SUFFIX,ip6-localhost,DIRECT,no-resolve
  - DOMAIN-SUFFIX,ip6-loopback,DIRECT,no-resolve
  - DOMAIN-SUFFIX,local,DIRECT,no-resolve
  - DOMAIN-SUFFIX,localhost,DIRECT,no-resolve
  - DOMAIN-SUFFIX,lan,DIRECT,no-resolve
  
  - GEOSITE,private,ç›´è¿
  - GEOSITE,category-ads-all,REJECT-DROP
  - GEOSITE,category-httpdns-cn,REJECT-DROP
#  - GEOSITE,baidu,REJECT-DROP
  - GEOSITE,youtube,YouTube
  - GEOSITE,tiktok,TikTok
  - GEOSITE,category-media,Media
  - GEOSITE,google,Google
  - GEOSITE,cloudflare,Cloudflare
  - GEOSITE,telegram,Telegram
  - GEOSITE,github,Microsoft
  - GEOSITE,bing,Microsoft
  - GEOSITE,onedrive,Microsoft
  - GEOSITE,microsoft,Microsoft
  - GEOSITE,geolocation-!cn,Global
  - GEOSITE,tencent-games@cn,ç›´è¿
  - GEOSITE,tencent@cn,ç›´è¿
  - GEOSITE,cn,Domestic 
   
  - GEOIP,private,ç›´è¿,no-resolve
  - GEOIP,cloudflare,Cloudflare,no-resolve
  - GEOIP,google,Google,no-resolve
  - GEOIP,telegram,Telegram,no-resolve
  - GEOIP,CN,Domestic,no-resolve
  - SRC-GEOIP,CN,Domestic,no-resolve
 
  - MATCH,Final

#####################
ipv6: false           # ip6å¼€å…³ï¼Œå½“ä¸ºfalseæ—¶ï¼Œåœæ­¢è§£æhostanmesä¸ºip6åœ°å€
log-level: info       # æ—¥å¿—ç­‰çº§ ï¼ˆinfo/warning/error/debug/silentï¼‰
allow-lan: false      # æ˜¯å¦å…è®¸å±€åŸŸç½‘é“¾æ¥(false/true)
unified-delay: false  # çµ±ä¸€å»¶é²
tcp-concurrent: true
external-controller: 127.0.0.1:9236   # å¤–éƒ¨æ§åˆ¶å™¨åœ°å€

clash-for-android:
  append-system-dns: false

profile:
  store-selected: true
  store-fake-ip: true
  tracing: true
  
hosts:
  mtalk.google.com: 108.177.97.188
  
sniffer:
  enable: true
  sniff:
    TLS:
      ports: [443, 8443]
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
  
dns:
  enable: true
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  listen: 127.0.0.1:1853
  
  default-nameserver:  #é»˜è®¤dns, ç”¨äºè§£æ DNS å™¨ çš„åŸŸå
    - "223.5.5.5"
    - "119.29.29.29"
    - "8.8.8.8"
    
  nameserver:  #é»˜è®¤çš„åŸŸåè§£æå™¨ï¼Œå¦‚ä¸é…ç½® fallback/proxy-server-nameserver , åˆ™æ‰€æœ‰åŸŸåéƒ½ç”± nameserver è§£æ
    - "https://doh.pub/dns-query"
    - "https://dns.alidns.com/dns-query"
  
  #proxy-server-nameserver:  #ä»£ç†åŸŸåè§£æå™¨ï¼Œä»…ç”¨äºè§£æä»£ç†çš„åŸŸå
    #- "https://doh.pub/dns-query"
    #- "https://1.0.0.1/dns-query"
    
  fallback:  #åå¤‡åŸŸåè§£æå™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨å¢ƒå¤– DNS, ä¿è¯ç»“æœå¯ä¿¡ï¼Œé…ç½® fallbackåé»˜è®¤å¯ç”¨ fallback-filter,geoip-codeä¸º cn
    - "tls://8.8.4.4:853"
    - "https://dns.cloudflare.com/dns-query"
    - "https://1.1.1.1/dns-query"
    
   # åœ¨ä»¥ä¸‹åˆ—è¡¨çš„åŸŸåå°†ä¸ä¼šè¢«è§£æä¸º fake ipï¼Œè¿™äº›åŸŸåç›¸å…³çš„è§£æè¯·æ±‚å°†ä¼šè¿”å›å®ƒä»¬çœŸå®çš„ IP åœ°å€
  fake-ip-filter:
    - "*.lan"
    - "*.localdomain"
    - "*.example"
    - "*.invalid"
    - "*.localhost"
    - "*.test"
    - "*.local"
    - "*.home.arpa"
    - time.*.com
    - time.*.gov
    - time.*.edu.cn
    - time.*.apple.com
    - time1.*.com
    - time2.*.com
    - time3.*.com
    - time4.*.com
    - time5.*.com
    - time6.*.com
    - time7.*.com
    - ntp.*.com
    - ntp1.*.com
    - ntp2.*.com
    - ntp3.*.com
    - ntp4.*.com
    - ntp5.*.com
    - ntp6.*.com
    - ntp7.*.com
    - "*.time.edu.cn"
    - "*.ntp.org.cn"
    - +.pool.ntp.org
    - time1.cloud.tencent.com
    - stun.*.*
    - stun.*.*.*
    - swscan.apple.com
    - mesu.apple.com
    - music.163.com
    - "*.music.163.com"
    - "*.126.net"
    - musicapi.taihe.com
    - music.taihe.com
    - songsearch.kugou.com
    - trackercdn.kugou.com
    - "*.kuwo.cn"
    - api-jooxtt.sanook.com
    - api.joox.com
    - y.qq.com
    - "*.y.qq.com"
    - streamoc.music.tc.qq.com
    - mobileoc.music.tc.qq.com
    - isure.stream.qqmusic.qq.com
    - dl.stream.qqmusic.qq.com
    - aqqmusic.tc.qq.com
    - amobile.music.tc.qq.com
    - localhost.ptlogin2.qq.com
    - "*.msftconnecttest.com"
    - "*.msftncsi.com"
    - "*.xiami.com"
    - "*.music.migu.cn"
    - music.migu.cn
    - +.wotgame.cn
    - +.wggames.cn
    - +.wowsgame.cn
    - +.wargaming.net
    - "*.*.*.srv.nintendo.net"
    - "*.*.stun.playstation.net"
    - "+.playstation.com"
    - "+.playstation.net"
    - "+.xboxlive.com"
    - "+.microsoft.com" 
    - xbox.*.*.microsoft.com
    - "*.*.xboxlive.com"
    - "*.ipv6.microsoft.com"
    - teredo.*.*.*
    - teredo.*.*
    - speedtest.cros.wr.pvp.net
    - +.jjvip8.com
    - www.douyu.com
    - activityapi.huya.com
    - activityapi.huya.com.w.cdngslb.com
    - www.bilibili.com
    - api.bilibili.com
    - a.w.bilicdn1.com
    
  fallback-filter:     #åå¤‡åŸŸåè§£æå™¨ç­›é€‰ï¼Œæ»¡è¶³æ¡ä»¶çš„å°†ä½¿ç”¨ fallbackç»“æœæˆ–åªä½¿ç”¨ fallbackè§£æ
    geoip: true        #ä¸ºçœŸæ—¶ï¼Œä¸åŒ¹é…ä¸ºgeoipè§„åˆ™çš„ä½¿ç”¨fallbackè¿”å›ç»“æœ
    geoip-code: CN     #geoipåŒ¹é…åŒºåŸŸè®¾å®š
    ipcidr:            #åˆ—è¡¨ä¸­çš„ipä½¿ç”¨fallbackè¿”å›è§£æç»“æœ
      - 240.0.0.0/4
      - 0.0.0.0/32
      - 127.0.0.1/32
    domain:            #åˆ—è¡¨ä¸­çš„åŸŸåä½¿ç”¨fallbackè¿”å›è§£æç»“æœ
      - +.facebook.com
      - +.twitter.com
      - +.google.com
      - +.googleapis.com
