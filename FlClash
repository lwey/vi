# ===================================
#锚点开始
#订阅名和订阅链接、图标
Provider1: &Provider1 "Eless"
Provider1Icon: &Provider1Icon "https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/Linkeless.png"
Provider2: &Provider2 "sntp"
Provider2Icon: &Provider2Icon "https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/shouhou(4).png"

# 连通性检测url
HeaCheckUrl: &HeaCheckUrl "https://www.apple.com/library/test/success.html"

# 节点筛选正则
FilterHK: &FilterHK '(?i)(港|🇭🇰|\bHK\b|hongkong|hong kong)'
FilterTW: &FilterTW '(?i)(🇨🇳|🇹🇼|台|\bTW\b|taiwan)'
FilterSG: &FilterSG '(?i)(新|🇸🇬|sg|singapore)'
FilterJP: &FilterJP '(?i)(日本|🇯🇵|川日|东京|大阪|泉日|埼玉|沪日|深日|\bJP\b|Japan)'
FilterKr: &FilterKR '^(?!.*((?i)Ukraine)).*(?i)(KOR|🇰🇷|韩国|首尔|韩|韓|\bKR\b|Korea)'
FilterUS: &FilterUS '(?i)(美|🇺🇸|波特兰|达拉斯|俄勒冈|凤凰城|费利蒙|硅谷|拉斯维加斯|洛杉矶|圣何塞|圣克拉拉|西雅图|芝加哥|\bUS\b|unitedstates|united states)'
#FilterRU: &FilterRU '(?i)(🇷🇺|俄罗斯|莫斯|\bRU\b|Russia|Moscow)'
#FilterOther: &FilterOther '^(?!.*(?i)(?:🇨🇳|🇨🇳|🇹🇼|🇭🇰|🇯🇵|🇺🇸|🇸🇬|🇰🇷|🇷🇺港|\bHK\b|Hong Kong|HongKong|hongkong|日本|川日|东京|大阪|泉日|埼玉|沪日|深日|[^-]日|\bHeaCheckUrlHeaCheckUrlJP\b|Japan|美|波特兰|达拉斯|俄勒冈|凤凰城|费利蒙|硅谷|拉斯维加斯|洛杉矶|圣何塞|圣克拉拉|西雅图|芝加哥|\bUS\b|United States|台|新北|彰化|\bTW\b|Taiwan|\bKR\b|Korea|KOR|首尔|韩|韓|狮城|狮|新加坡|坡|\bSG\b|Singapore|俄罗斯|莫斯|\bRU\b|Russia|Moscow)).*$'
ExcludeFilter: &ExcludeFilter '(?i)(佣金|套餐|官网|官方|售后|免翻|直连|过期|剩余|到期|流量|更新|点外|重置|免流|优惠|超实惠|址|AFF|Direct|Days|Date)'
FilterLowMag: &FilterLowMag '0\.\d+'           #低倍率节点
FilterHighMag: &FilterHighMag '(?!0\.)[1-9]\d*(?:\.\d+)'            #高倍率节点

# 订阅更新与测试
Proxyer: &Proxyer
    type: http
    interval: 3600
    health-check:
      enable: true
      url: *HeaCheckUrl
      tolerance: 50
      timeout: 5000

# 订阅引用
Uses: &Uses 
    type: select
    include-all-providers: true
    exclude-filter: *ExcludeFilter

# 策略组引用
Selector: &Selector
   type: select
   proxies: [ 香港, 台湾, 新加坡, 日本, 韩国, 美国, 低倍, 高倍 ]

# 延迟优选策略组
auto: &auto
   type: url-test 
   url: *HeaCheckUrl
   tolerance : 50
   interval: 300
   timeout : 5000
   <<: *Uses     

# 负载均衡策略组策略可选round-robin, consistent-hashing
loads: &loads
   type: load-balance
   url: *HeaCheckUrl
   interval: 300
   strategy: sticky-sessions
   <<: *Uses

# 故障转移
fallb: &fallb
  type: fallback
  url: *HeaCheckUrl
  interval: 300
  <<: *Uses

rule-anchor:
  # 规则类型:domain
  dom: &dom { type: http, behavior: domain, interval: 86400 }
  # 规则类型:classical
  cla: &cla { type: http, behavior: classical, interval: 86400 }
  # 规则类型:ipcidr
  ipc: &ipc { type: http, behavior: ipcidr, interval: 86400 }

proxies:
  - name: 直连
    type: direct
    udp: true
  - name: 禁止
    type: reject
  - name: DNS劫持
    type: dns
    udp: true

proxy-providers:      
  Sub-Store:
    <<: *Proxyer
    path: ./proxies/Sub-Store.yaml
    url: 'https://sub.xfltd.click/api/v1/client/subscribe?token=eb12a3e82e14a816698b1d358f06da22'
#    exclude-filter: *ExcludeFilter
    override:
      udp: true
  

proxy-groups:
#  - { name: AdBlock, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Advertising.png", <<: *Selector }
  - { name: Telegram, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Telegram.png", <<: *Selector }
  - { name: TikTok, icon: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/icon/color/tiktok.png", <<: *Selector } 
  - { name: YouTube, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/YouTube.png", <<: *Selector }
  - { name: Google, icon: "https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/google(1).png", <<: *Selector }
  - { name: Media, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/ForeignMedia.png", <<: *Selector }
  - { name: Microsoft, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Microsoft.png", <<: *Selector } 
  - { name: VPN, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Server.png", <<: *Selector }
  - { name: Emby, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Emby.png", <<: *Selector }
  - { name: Global, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Global.png", <<: *Selector } 
  - { name: Cloudflare, icon: "https://raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/Cloudflare.png", <<: *Selector }
  - { name: Domestic, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Domestic.png", <<: *Selector }  
  - { name: Final, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Final.png", <<: *Selector }
  # 手动＆自动
  - { name: 自选, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/MY.png", <<: *Uses }
#  - { name: 自动, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Auto.png", <<: *auto }
  # 分隔,下面是地区分组
  # 故障转移分组(fallback)
  - { name: 香港, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Hong_Kong.png", <<: *fallb, filter: *FilterHK, hidden: true }  
  - { name: 台湾, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Taiwan.png", <<: *fallb, filter: *FilterTW, hidden: true } 
  - { name: 新加坡, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Singapore.png", <<: *fallb, filter: *FilterSG, hidden: true } 
  - { name: 日本, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Japan.png", <<: *fallb, filter: *FilterJP, hidden: true }
  - { name: 韩国, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Korea.png", <<: *fallb, filter: *FilterKR, hidden: true }  
  - { name: 美国, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_States.png", <<: *fallb, filter: *FilterUS, hidden: true }
#  - { name: 俄国, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Russia.png", <<: *fallb, filter: *FilterRU, hidden: true }
#  - { name: 其他, icon: "https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/quanqiu(3).png", <<: *fallb, filter: *FilterOther, hidden: true}
  - { name: 低倍, icon: "https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/liuliang(2).png", <<:  *fallb, filter: *FilterLowMag, hidden: true }
  - { name: 高倍, icon: "https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/liuliang(3).png", <<: *fallb, filter: *FilterHighMag, hidden: true }
  # 机场分组
  - name: *Provider1
    <<: *Uses
    filter: *Provider1
    icon: *Provider1Icon
    hidden: true
  - name: *Provider2
    <<: *Uses
    filter: *Provider2
    icon: *Provider2Icon
    hidden: true


rule-providers:
  秋风广告规则: {<<: *dom, format: yaml, url: "https://raw.githubusercontent.com/TG-Twilight/AWAvenue-Ads-Rule/main/Filters/AWAvenue-Ads-Rule-Clash.yaml", path: ./rules/AWAvenue-Ads-Rule-Clash.yaml}
  advertising: {<<: *cla, format: yaml, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/Advertising/Advertising_Classical_No_Resolve.yaml", path: ./rules/advertising.yaml}
  GoogleFCM: {<<: *cla, format: yaml, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/GoogleFCM/GoogleFCM_No_Resolve.yaml", path: ./rules/GoogleFCM.yaml}

rules:
  - DST-PORT,53,DNS劫持
#  - IP-SUFFIX,121.41.111.155,直连,no-resolve
#  - AND,((DST-PORT,443),(NETWORK,UDP)),REJECT-DROP    # 屏蔽QUIC
  - DOMAIN-REGEX,^ad\..*|ads\..*,REJECT-DROP
  - DOMAIN-REGEX, ^hk(?:[^.]+\.){1,2}(?:wechat|wexin)\.com$,香港
  - DOMAIN-REGEX, ^sg(?:[^.]+\.){1,2}(?:wechat|wexin)\.com$,新加坡
  - DOMAIN-KEYWORD,linkeless,VPN
  - DOMAIN-KEYWORD,sntp,VPN  
  - DOMAIN-SUFFIX,metacubex.one,Global

  - RULE-SET,advertising,REJECT-DROP 
  - RULE-SET,秋风广告规则,REJECT-DROP
  - RULE-SET,GoogleFCM,Domestic

#本地局域网
  - DOMAIN-SUFFIX,ip6-localhost,DIRECT,no-resolve
  - DOMAIN-SUFFIX,ip6-loopback,DIRECT,no-resolve
  - DOMAIN-SUFFIX,local,DIRECT,no-resolve
  - DOMAIN-SUFFIX,localhost,DIRECT,no-resolve
  - DOMAIN-SUFFIX,lan,DIRECT,no-resolve
  
  - GEOSITE,private,直连
  - GEOSITE,category-ads-all,REJECT-DROP
  - GEOSITE,category-httpdns-cn,REJECT-DROP
#  - GEOSITE,baidu,REJECT-DROP
  - GEOSITE,youtube,YouTube
  - GEOSITE,tiktok,TikTok
  - GEOSITE,category-media,Media
  - GEOSITE,google,Google
  - GEOSITE,cloudflare,Cloudflare
  - GEOSITE,telegram,Telegram
  - GEOSITE,github,Microsoft
  - GEOSITE,bing,Microsoft
  - GEOSITE,onedrive,Microsoft
  - GEOSITE,microsoft,Microsoft
  - GEOSITE,geolocation-!cn,Global
  - GEOSITE,tencent-games@cn,直连
  - GEOSITE,tencent@cn,直连
  - GEOSITE,cn,Domestic 
   
  - GEOIP,private,直连,no-resolve
  - GEOIP,cloudflare,Cloudflare,no-resolve
  - GEOIP,google,Google,no-resolve
  - GEOIP,telegram,Telegram,no-resolve
  - GEOIP,CN,Domestic,no-resolve
  - SRC-GEOIP,CN,Domestic,no-resolve
 
  - MATCH,Final

#####################
ipv6: false           # ip6开关，当为false时，停止解析hostanmes为ip6地址
log-level: info       # 日志等级 （info/warning/error/debug/silent）
allow-lan: false      # 是否允许局域网链接(false/true)
unified-delay: false  # 統一延遲
tcp-concurrent: true
external-controller: 127.0.0.1:9236   # 外部控制器地址

clash-for-android:
  append-system-dns: false

profile:
  store-selected: true
  store-fake-ip: true
  tracing: true
  
hosts:
  mtalk.google.com: 108.177.97.188
  
sniffer:
  enable: true
  sniff:
    TLS:
      ports: [443, 8443]
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
  
dns:
  enable: true
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  listen: 127.0.0.1:1853
  
  default-nameserver:  #默认dns, 用于解析 DNS 器 的域名
    - "223.5.5.5"
    - "119.29.29.29"
    - "8.8.8.8"
    
  nameserver:  #默认的域名解析器，如不配置 fallback/proxy-server-nameserver , 则所有域名都由 nameserver 解析
    - "https://doh.pub/dns-query"
    - "https://dns.alidns.com/dns-query"
  
  #proxy-server-nameserver:  #代理域名解析器，仅用于解析代理的域名
    #- "https://doh.pub/dns-query"
    #- "https://1.0.0.1/dns-query"
    
  fallback:  #后备域名解析器，一般情况下使用境外 DNS, 保证结果可信，配置 fallback后默认启用 fallback-filter,geoip-code为 cn
    - "tls://8.8.4.4:853"
    - "https://dns.cloudflare.com/dns-query"
    - "https://1.1.1.1/dns-query"
    
   # 在以下列表的域名将不会被解析为 fake ip，这些域名相关的解析请求将会返回它们真实的 IP 地址
  fake-ip-filter:
    - "*.lan"
    - "*.localdomain"
    - "*.example"
    - "*.invalid"
    - "*.localhost"
    - "*.test"
    - "*.local"
    - "*.home.arpa"
    - time.*.com
    - time.*.gov
    - time.*.edu.cn
    - time.*.apple.com
    - time1.*.com
    - time2.*.com
    - time3.*.com
    - time4.*.com
    - time5.*.com
    - time6.*.com
    - time7.*.com
    - ntp.*.com
    - ntp1.*.com
    - ntp2.*.com
    - ntp3.*.com
    - ntp4.*.com
    - ntp5.*.com
    - ntp6.*.com
    - ntp7.*.com
    - "*.time.edu.cn"
    - "*.ntp.org.cn"
    - +.pool.ntp.org
    - time1.cloud.tencent.com
    - stun.*.*
    - stun.*.*.*
    - swscan.apple.com
    - mesu.apple.com
    - music.163.com
    - "*.music.163.com"
    - "*.126.net"
    - musicapi.taihe.com
    - music.taihe.com
    - songsearch.kugou.com
    - trackercdn.kugou.com
    - "*.kuwo.cn"
    - api-jooxtt.sanook.com
    - api.joox.com
    - y.qq.com
    - "*.y.qq.com"
    - streamoc.music.tc.qq.com
    - mobileoc.music.tc.qq.com
    - isure.stream.qqmusic.qq.com
    - dl.stream.qqmusic.qq.com
    - aqqmusic.tc.qq.com
    - amobile.music.tc.qq.com
    - localhost.ptlogin2.qq.com
    - "*.msftconnecttest.com"
    - "*.msftncsi.com"
    - "*.xiami.com"
    - "*.music.migu.cn"
    - music.migu.cn
    - +.wotgame.cn
    - +.wggames.cn
    - +.wowsgame.cn
    - +.wargaming.net
    - "*.*.*.srv.nintendo.net"
    - "*.*.stun.playstation.net"
    - "+.playstation.com"
    - "+.playstation.net"
    - "+.xboxlive.com"
    - "+.microsoft.com" 
    - xbox.*.*.microsoft.com
    - "*.*.xboxlive.com"
    - "*.ipv6.microsoft.com"
    - teredo.*.*.*
    - teredo.*.*
    - speedtest.cros.wr.pvp.net
    - +.jjvip8.com
    - www.douyu.com
    - activityapi.huya.com
    - activityapi.huya.com.w.cdngslb.com
    - www.bilibili.com
    - api.bilibili.com
    - a.w.bilicdn1.com
    
  fallback-filter:     #后备域名解析器筛选，满足条件的将使用 fallback结果或只使用 fallback解析
    geoip: true        #为真时，不匹配为geoip规则的使用fallback返回结果
    geoip-code: CN     #geoip匹配区域设定
    ipcidr:            #列表中的ip使用fallback返回解析结果
      - 240.0.0.0/4
      - 0.0.0.0/32
      - 127.0.0.1/32
    domain:            #列表中的域名使用fallback返回解析结果
      - +.facebook.com
      - +.twitter.com
      - +.google.com
      - +.googleapis.com
