# ===================================
#é”šç‚¹å¼€å§‹
#è®¢é˜…åå’Œè®¢é˜…é“¾æ¥ã€å›¾æ ‡
Provider1: &Provider1 "Eless"
Provider1Icon: &Provider1Icon "https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/Linkeless.png"
Provider2: &Provider2 "sntp"
Provider2Icon: &Provider2Icon "https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/shouhou(4).png"

# è¿é€šæ€§æ£€æµ‹url
HeaCheckUrl: &HeaCheckUrl "https://www.apple.com/library/test/success.html"

# èŠ‚ç‚¹ç­›é€‰æ­£åˆ™
FilterHK: &FilterHK '(?i)(æ¸¯|ğŸ‡­ğŸ‡°|\bHK\b|hongkong|hong kong)'
FilterHKSP: &FilterHKSP '(?i)(æ¸¯|ğŸ‡­ğŸ‡°|\bHK\b|hongkong|hong kong).*(?i)(HKT|HGC|HKBN|CMHK|iCable|Special|iepl|iplc|å®¶å®½|å®¶åº­|Home|2.00)'
FilterTW: &FilterTW '(?i)(ğŸ‡¨ğŸ‡³|ğŸ‡¹ğŸ‡¼|å°|\bTW\b|taiwan)'
FilterTWSP: &FilterTWSP '(?i)(ğŸ‡¨ğŸ‡³|ğŸ‡¹ğŸ‡¼|å°|\bTW\b|taiwan).*(?i)(Hinet|Special|iepl|iplc|å®¶å®½|å®¶åº­|Home|2.00)'
FilterSG: &FilterSG '(?i)(æ–°|ğŸ‡¸ğŸ‡¬|sg|singapore)'
FilterSGSP: &FilterSGSP '(?i)(æ–°|ğŸ‡¸ğŸ‡¬|\bSG\b|singapore).*(?i)(SGGS|Special|iepl|iplc|å®¶å®½|å®¶åº­|Home|2.00)'
FilterJP: &FilterJP '(?i)(æ—¥æœ¬|ğŸ‡¯ğŸ‡µ|å·æ—¥|ä¸œäº¬|å¤§é˜ª|æ³‰æ—¥|åŸ¼ç‰|æ²ªæ—¥|æ·±æ—¥|\bJP\b|Japan)'
FilterJPSP: &FilterJPSP '(?i)(æ—¥æœ¬|ğŸ‡¯ğŸ‡µ|å·æ—¥|ä¸œäº¬|å¤§é˜ª|æ³‰æ—¥|åŸ¼ç‰|æ²ªæ—¥|æ·±æ—¥|\bJP\b|Japan).*(?i)(Sonet|BIGLOBE|KDDI|Special|iepl|iplc|å®¶å®½|å®¶åº­|Home|2.00)'
FilterKr: &FilterKR '^(?!.*((?i)Ukraine)).*(?i)(KOR|ğŸ‡°ğŸ‡·|éŸ©å›½|é¦–å°”|éŸ©|éŸ“|\bKR\b|Korea)'
FilterUS: &FilterUS '(?i)(ç¾|ğŸ‡ºğŸ‡¸|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|ä¿„å‹’å†ˆ|å‡¤å‡°åŸ|è´¹åˆ©è’™|ç¡…è°·|æ‹‰æ–¯ç»´åŠ æ–¯|æ´›æ‰çŸ¶|åœ£ä½•å¡|åœ£å…‹æ‹‰æ‹‰|è¥¿é›…å›¾|èŠåŠ å“¥|\bUS\b|unitedstates|united states)'
FilterUSSP: &FilterUSSP '(?i)(ç¾|ğŸ‡ºğŸ‡¸|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|ä¿„å‹’å†ˆ|å‡¤å‡°åŸ|è´¹åˆ©è’™|ç¡…è°·|æ‹‰æ–¯ç»´åŠ æ–¯|æ´›æ‰çŸ¶|åœ£ä½•å¡|åœ£å…‹æ‹‰æ‹‰|è¥¿é›…å›¾|èŠåŠ å“¥|\bUS\b|unitedstates|united states).*(?i)(AT|Frontier|Atlas|Special|iepl|iplc|å®¶å®½|å®¶åº­|Home|2.00)'
FilterRU: &FilterRU '(?i)(ğŸ‡·ğŸ‡º|ä¿„ç½—æ–¯|è«æ–¯|\bRU\b|Russia|Moscow)'
FilterOther: &FilterOther '^(?!.*(?i)(?:ğŸ‡¨ğŸ‡³|ğŸ‡¨ğŸ‡³|ğŸ‡¹ğŸ‡¼|ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡°ğŸ‡·|ğŸ‡·ğŸ‡ºæ¸¯|\bHK\b|Hong Kong|HongKong|hongkong|æ—¥æœ¬|å·æ—¥|ä¸œäº¬|å¤§é˜ª|æ³‰æ—¥|åŸ¼ç‰|æ²ªæ—¥|æ·±æ—¥|[^-]æ—¥|\bHeaCheckUrlHeaCheckUrlJP\b|Japan|ç¾|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|ä¿„å‹’å†ˆ|å‡¤å‡°åŸ|è´¹åˆ©è’™|ç¡…è°·|æ‹‰æ–¯ç»´åŠ æ–¯|æ´›æ‰çŸ¶|åœ£ä½•å¡|åœ£å…‹æ‹‰æ‹‰|è¥¿é›…å›¾|èŠåŠ å“¥|\bUS\b|United States|å°|æ–°åŒ—|å½°åŒ–|\bTW\b|Taiwan|\bKR\b|Korea|KOR|é¦–å°”|éŸ©|éŸ“|ç‹®åŸ|ç‹®|æ–°åŠ å¡|å¡|\bSG\b|Singapore|ä¿„ç½—æ–¯|è«æ–¯|\bRU\b|Russia|Moscow)).*$'
ExcludeFilter: &ExcludeFilter '(?i)(ä½£é‡‘|å¥—é¤|å®˜ç½‘|å®˜æ–¹|å”®å|å…ç¿»|è¿‡æœŸ|å‰©ä½™|åˆ°æœŸ|æµé‡|æ›´æ–°|ç‚¹å¤–|é‡ç½®|å…æµ|ä¼˜æƒ |è¶…å®æƒ |å€|AFF|Direct|Days|Date)'
FilterLowMag: &FilterLowMag '0\.\d+'           #ä½å€ç‡èŠ‚ç‚¹
FilterHighMag: &FilterHighMag '(?!0\.)[1-9]\d*(?:\.\d+)'            #é«˜å€ç‡èŠ‚ç‚¹

# è®¢é˜…æ›´æ–°ä¸æµ‹è¯•
Proxyer: &Proxyer
    type: http
    interval: 3600
    health-check:
      enable: true
      url: *HeaCheckUrl
      tolerance: 50
      timeout: 5000

# è®¢é˜…å¼•ç”¨
Uses: &Uses 
    type: select
    include-all-providers: true
    exclude-filter: *ExcludeFilter

# ç­–ç•¥ç»„å¼•ç”¨
Selector: &Selector
   type: select
   proxies: [ ç›´è¿, ç¦æ­¢, è‡ªé€‰, é¦™æ±Ÿ, å®å²›, ç‹®åŸ, å€­å›½, èŠ±æ——, é¦™æ¸¯, å°æ¹¾, æ–°åŠ å¡, æ—¥æœ¬, éŸ©å›½, ç¾å›½, ä¿„å›½, å…¶ä»–, ä½å€, é«˜å€ ]

# å»¶è¿Ÿä¼˜é€‰ç­–ç•¥ç»„
auto: &auto
   type: url-test 
   url: *HeaCheckUrl
   tolerance : 50
   interval: 300
   timeout : 5000
   <<: *Uses     

# è´Ÿè½½å‡è¡¡ç­–ç•¥ç»„ç­–ç•¥å¯é€‰round-robin, consistent-hashing
loads: &loads
   type: load-balance
   url: *HeaCheckUrl
   interval: 300
   strategy: sticky-sessions
   <<: *Uses

# æ•…éšœè½¬ç§»
fallb: &fallb
  type: fallback
  url: *HeaCheckUrl
  interval: 300
  <<: *Uses

rule-anchor:
  # è§„åˆ™ç±»å‹:domain
  dom: &dom { type: http, behavior: domain, interval: 86400 }
  # è§„åˆ™ç±»å‹:classical
  cla: &cla { type: http, behavior: classical, interval: 86400 }
  # è§„åˆ™ç±»å‹:ipcidr
  ipc: &ipc { type: http, behavior: ipcidr, interval: 86400 }

# ==================================
#é”šç‚¹ç»“æŸ
###############


proxies:
  - { name: "ç›´è¿", type: direct, udp: true, ip-version: ipv4 }
  - { name: "ç¦æ­¢", type: reject }
  - { name: "DNSåŠ«æŒ", type: dns }

proxy-providers:      
  Sub-Store:
    <<: *Proxyer
    path: ./proxies/Sub-Store.yaml
    url: http://127.0.0.1:3000/download/collection/Sub
#    exclude-filter: *ExcludeFilter
    override:
      udp: true
  

proxy-groups:
#  - { name: AdBlock, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Advertising.png", <<: *Selector }
  - { name: VPN, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Server.png", <<: *Selector }
  - { name: Emby, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Emby.png", <<: *Selector }
  - { name: TikTok, icon: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/icon/color/tiktok.png", <<: *Selector } 
  - { name: YouTube, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/YouTube.png", <<: *Selector }
  - { name: Media, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/ForeignMedia.png", <<: *Selector }
  - { name: Google, icon: "https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/google(1).png", <<: *Selector }
  - { name: Cloudflare, icon: "https://raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/Cloudflare.png", <<: *Selector }
  - { name: Telegram, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Telegram.png", <<: *Selector }
  - { name: Microsoft, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Microsoft.png", <<: *Selector } 
  - { name: Global, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Global.png", <<: *Selector } 
  - { name: Domestic, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Domestic.png", <<: *Selector }  
  - { name: Final, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Final.png", <<: *Selector }
  # æ‰‹åŠ¨ï¼†è‡ªåŠ¨
  - { name: æ¼«æ¸¸, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Cellular.png", <<: *Freec }  
  - { name: è‡ªé€‰, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/MY.png", <<: *Uses }
#  - { name: è‡ªåŠ¨, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Auto.png", <<: *auto }
  # åˆ†éš”,ä¸‹é¢æ˜¯åœ°åŒºåˆ†ç»„
  # ç‰¹æ®Šåœ°åŒºåˆ†ç»„
  - { name: é¦™æ±Ÿ, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/HK.png", <<: *fallb, filter: *FilterHKSP, hidden: true }
  - { name: å®å²›, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/TW.png", <<: *fallb, filter: *FilterTWSP, hidden: true }
  - { name: ç‹®åŸ, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/SG.png", <<: *fallb, filter: *FilterSGSP, hidden: true }
  - { name: å€­å›½, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/JP.png", <<: *fallb, filter: *FilterJPSP, hidden: true }
  - { name: èŠ±æ——, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/US.png", <<: *fallb, filter: *FilterUSSP, hidden: true }
  # æ•…éšœè½¬ç§»åˆ†ç»„(fallback)
  - { name: é¦™æ¸¯, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Hong_Kong.png", <<: *fallb, filter: *FilterHK, hidden: true }  
  - { name: å°æ¹¾, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Taiwan.png", <<: *fallb, filter: *FilterTW, hidden: true } 
  - { name: æ–°åŠ å¡, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Singapore.png", <<: *fallb, filter: *FilterSG, hidden: true } 
  - { name: æ—¥æœ¬, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Japan.png", <<: *fallb, filter: *FilterJP, hidden: true }
  - { name: éŸ©å›½, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Korea.png", <<: *fallb, filter: *FilterKR, hidden: true }  
  - { name: ç¾å›½, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_States.png", <<: *fallb, filter: *FilterUS, hidden: true }
  - { name: ä¿„å›½, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Russia.png", <<: *fallb, filter: *FilterRU, hidden: true }
  - { name: å…¶ä»–, icon: "https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/quanqiu(3).png", <<: *fallb, filter: *FilterOther, hidden: true}
  - { name: ä½å€, icon: "https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/liuliang(2).png", <<:  *fallb, filter: *FilterLowMag, hidden: true }
  - { name: é«˜å€, icon: "https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/liuliang(3).png", <<: *fallb, filter: *FilterHighMag, hidden: true }
  # æœºåœºåˆ†ç»„
  - name: *Provider1
    <<: *Uses
    filter: *Provider1
    icon: *Provider1Icon
    hidden: true
  - name: *Provider2
    <<: *Uses
    filter: *Provider2
    icon: *Provider2Icon
    hidden: true


rule-providers:
  ç§‹é£å¹¿å‘Šè§„åˆ™: {<<: *dom, format: yaml, path: ./rules/AWAvenue-Ads-Rule-Clash.yaml, url: "https://raw.githubusercontent.com/TG-Twilight/AWAvenue-Ads-Rule/main/Filters/AWAvenue-Ads-Rule-Clash.yaml"}
  anti-ad: {<<: *cla, format: text, url: "https://raw.githubusercontent.com/privacy-protection-tools/anti-AD/master/anti-ad-surge.txt", path: ./rules/anti-ad.txt}
  GoogleFCM: {<<: *cla, format: yaml, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/GoogleFCM/GoogleFCM_No_Resolve.yaml", path: ./rules/GoogleFCM.yaml}


rules:
  - DST-PORT,53,DNSåŠ«æŒ
#  - IP-SUFFIX,121.41.111.155,ç›´è¿,no-resolve
#  - AND,((DST-PORT,443),(NETWORK,UDP)),REJECT-DROP    # å±è”½QUIC
  - DOMAIN-REGEX,^ad\..*|ads\..*,REJECT-DROP
  - DOMAIN-REGEX, ^hk(?:[^.]+\.){1,2}(?:wechat|wexin)\.com$,é¦™æ¸¯
  - DOMAIN-REGEX, ^sg(?:[^.]+\.){1,2}(?:wechat|wexin)\.com$,æ–°åŠ å¡
  - OR,((DOMAIN-KEYWORD,emby),(PROCESS-NAME-REGEX,yamby)),Emby
  - OR,((PROCESS-NAME-REGEX,com.ct.client),(DOMAIN-SUFFIX,189.cn)),ç›´è¿
  - OR,((PROCESS-NAME-REGEX,bestpayclient),(DOMAIN-KEYWORD,bestpay)),ç›´è¿
  - DOMAIN-SUFFIX,cauenvao.click,VPN
  - DOMAIN-KEYWORD,linkeless,VPN
  - DOMAIN-KEYWORD,sntp,VPN  
  - DOMAIN-KEYWORD,ouoboom,VPN
  - DOMAIN-KEYWORD,ouonet,VPN
  - DOMAIN-SUFFIX,metacubex.one,Global
 
  - RULE-SET,ç§‹é£å¹¿å‘Šè§„åˆ™,REJECT-DROP
  - RULE-SET,anti-ad,REJECT-DROP
  - RULE-SET,GoogleFCM,Domestic

  - GEOSITE,private,ç›´è¿
  - GEOSITE,category-ads-all,REJECT-DROP
  - GEOSITE,category-httpdns-cn,REJECT-DROP
#  - GEOSITE,baidu,REJECT-DROP
  - GEOSITE,youtube,YouTube
  - GEOSITE,tiktok,TikTok
  - GEOSITE,category-media,Media
  - GEOSITE,google,Google
  - GEOSITE,cloudflare,Cloudflare
  - GEOSITE,telegram,Telegram
  - GEOSITE,github,Microsoft
  - GEOSITE,bing,Microsoft
  - GEOSITE,onedrive,Microsoft
  - GEOSITE,microsoft,Microsoft
  - GEOSITE,geolocation-!cn,Global
  - GEOSITE,tencent-games@cn,ç›´è¿
  - GEOSITE,tencent@cn,ç›´è¿
  - GEOSITE,cn,Domestic 
   
  - GEOIP,private,ç›´è¿,no-resolve
  - GEOIP,cloudflare,Cloudflare,no-resolve
  - GEOIP,google,Google,no-resolve
  - GEOIP,telegram,Telegram,no-resolve
  - GEOIP,CN,Domestic,no-resolve
  - SRC-GEOIP,CN,Domestic,no-resolve
 
  - MATCH,Final

#####################
#é€šç”¨é…ç½®
mixed-port: 7890
redir-port: 7891
tproxy-port: 1536
mode: rule
allow-lan: true
ipv6: false
unified-delay: true
tcp-concurrent: true
enable-process: true
log-level: silent

geodata-mode: true     #trueæ—¶geoip.æ–‡ä»¶ä¸ºdatæ ¼å¼ï¼Œfalseæ—¶ä¸ºmmdbæ ¼å¼
geodata-loader: standard
geo-auto-update: true
geo-update-interval: 168
geox-url:
  geoip: "https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip.dat"
  geosite: "https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
  mmdb: "https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country.mmdb"
  asn: "https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/GeoLite2-ASN.mmdb"

#åŒ¹é…è¿›ç¨‹
find-process-mode: strict
keep-alive-idle: 15
keep-alive-internal: 30
global-client-fingerprint: chrome

#æ§åˆ¶é¢æ¿
external-controller: 0.0.0.0:9090
#é¢æ¿é»˜è®¤Meta å¯é€‰Yacd æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å³å¯é‡æ–°åŠ è½½
external-ui: /data/adb/box_bll/panel/Zash/ #/Meta #/Yacd
external-ui-url: "https://github.com/Zephyruso/zashboard/archive/refs/heads/gh-pages.zip"
secret: ""

profile:
  store-selected: true
  store-fake-ip: true

sniffer:
  enable: true
  force-dns-mapping: true
  parse-pure-ip: true
  override-destination: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  force-domain:
    - "+.v2ex.com"
  skip-domain:
    - "Mijia Cloud"

tun:
  enable: true 
  device: Mihomo
  stack: mixed
  dns-hijack:
    - "any:53"
    - "tcp://any:53"
  auto-route: true
  strict-route: true
  auto-redirect: false
  auto-detect-interface: true
  route-exclude-address:
    - 192.168.0.0/16
    - fc00::/7
  exclude-package: #

dns:
  enable: true
  prefer-h3: true
  ipv6: true
  listen: 0.0.0.0:1053
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.0/15
  fake-ip-filter:
    - "*"
    - "+.lan"
    - "connect.rom.miui.com"
    - "localhost.ptlogin2.qq.com"
  default-nameserver:
    - 223.5.5.5
    - 223.6.6.6
    - 119.29.29.29
  nameserver-policy:
    'geosite:category-ads-all': rcode://success
    'geosite:jd,tencent,meituan,zhihu,huya,douyu,bilibili,pinduoduo':
      - https://doh.pub/dns-query
    'geosite:aliyun,alibaba,alibabacloud,netease,eleme,sina':
      - https://dns.alidns.com/dns-query
    'geosite:bytedance,tiktok':
      - 180.184.1.1
      - 180.184.2.2
    'geosite:private,cn':
      - https://dns.alidns.com/dns-query
      - https://doh.pub/dns-query
  nameserver:
    - https://dns.google/dns-query
    - https://cloudflare-dns.com/dns-query
  proxy-server-nameserver:
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query  